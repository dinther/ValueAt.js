<!DOCTYPE html>
<html lang="en" class="nowhitespace">
	<head>
		<meta name="description" content="Beam editor for show lasers.">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ValueAt.js</title>
        <link rel="stylesheet" href="index.css">
        <link rel="stylesheet" href="valueAtTimeline.css">
	</head>
	<body>
        <div id="timeline"></div>

        <script type="module">
            import {LookupAtTime} from "./valueat.js"
            import * as lookupAtExport from "./lookupAtToStepList.js";
            import * as Easings from "./easings.js";
            import {drawValueAtOnSVG, createValueAtUILine} from "./valueui.js";
            import {ValueAtTimeLine} from "./valueAtTimeline.js";

            var va_red1 = new LookupAtTime('red');
            va_red1.addValueKey(0,-50);
            va_red1.addValueKey(30,100, Easings.linear, 0.5);
            va_red1.addValueKey(85,60, Easings.easeInOutQuad);
            va_red1.addValueKey(100,0,Easings.easeOutCirc);
            va_red1.init(1);
             
            var va_green1 = new LookupAtTime('green');
            va_green1.addValueKey(0,-50);
            va_green1.addValueKey(40,100, Easings.easeOut, 0.5);
            va_green1.addValueKey(75,60, Easings.easeInOut);
            va_green1.addValueKey(100,0,Easings.easeIn);
            va_green1.init(1);

            var va_blue1 = new LookupAtTime('blue');
            va_blue1.addValueKey(0,-50);
            va_blue1.addValueKey(50,100, Easings.easeinBounce, 0.5);
            va_blue1.addValueKey(95,60, Easings.easeInOutQuad);
            va_blue1.addValueKey(100,0,Easings.easeOutCirc);
            va_blue1.init(1);            

            var va_pos_x1 = new LookupAtTime('xpos');
            //  construct our own bounce animation
            let step = 1;
            let r = 0.6;
            let x = 0;
            let v = 100;
            va_pos_x1.addValueKey(x,0); x += step;
            for (let i=0; i< 7; i++){
                va_pos_x1.addValueKey(x,v, Easings.easeOutSine); x += step; step *= r;
                va_pos_x1.addValueKey(x,0, Easings.easeInSine); x += step; v *= r;   
            }
            va_pos_x1.addValueKey(36.5,0,Easings.easeInOutCirc); x += step;
            va_pos_x1.addValueKey(40,100,Easings.easeInOutCirc); x += step;
            va_pos_x1.addValueKey(86,100,Easings.easeInOutCirc); x += step;
            va_pos_x1.addValueKey(90,0,Easings.easeInOutCirc); x += step;
            va_pos_x1.init(0.1);

            var va_pos_y1 = new LookupAtTime('ypos');
            va_pos_y1.addValueKey(10,-50);
            va_pos_y1.addValueKey(30,100, Easings.easeOut, 0.5);
            va_pos_y1.addValueKey(75,60, Easings.easeInOut);
            va_pos_y1.addValueKey(100,0,Easings.easeIn);
            va_pos_y1.init(1);     

            var va_scale_x1 = new LookupAtTime('xscale');
            va_scale_x1.addValueKey(8,500);
            va_scale_x1.addValueKey(13,1000, Easings.easeInOutElastic, 0.9);
            va_scale_x1.addValueKey(24, 0, Easings.easeOutElastic, 0.9);
            va_scale_x1.addValueKey(70, 0, Easings.easeInOut);
            va_scale_x1.init(0.01);
            
            var va_scale_y1 = new LookupAtTime('yscale');
            va_scale_y1.addValueKey(8,500);
            va_scale_y1.addValueKey(13,0, Easings.easeInOutElastic, 0.9);
            va_scale_y1.addValueKey(24, 1000, Easings.easeOutElastic, 0.9);
            va_scale_y1.addValueKey(60, 0, Easings.easeInOut);
            va_scale_y1.init(0.01); 

            var va_rotate_x1 = new LookupAtTime('xrot');
            va_rotate_x1.addValueKey(10,-50);
            va_rotate_x1.addValueKey(30,100, Easings.easeOut, 0.5);
            va_rotate_x1.addValueKey(75,60, Easings.easeInOut);
            va_rotate_x1.addValueKey(100,0,Easings.easeIn);
            va_rotate_x1.init(1);

            var va_rotate_y1 = new LookupAtTime('yrot');
            va_rotate_y1.addValueKey(8,500);
            va_rotate_y1.addValueKey(13,1000, Easings.easeInOutElastic, 0.9);
            va_rotate_y1.addValueKey(24, 0, Easings.easeOutElastic, 0.9);
            va_rotate_y1.addValueKey(70, 600, Easings.easeInOut);
            va_rotate_y1.init(0.01);

            var va_rotate_z1 = new LookupAtTime('zrot');
            va_rotate_z1.addValueKey(0,0);
            va_rotate_z1.addValueKey(50,0);
            va_rotate_z1.addValueKey(100,360, Easings.linear);
            va_rotate_z1.init(0.1);



            var va_red2 = new LookupAtTime('red');
            va_red2.addValueKey(0,-50);
            va_red2.addValueKey(20,100, Easings.linear, 0.5);
            va_red2.addValueKey(65,60, Easings.easeInOutQuad);
            va_red2.addValueKey(100,0,Easings.easeOutCirc);
            va_red2.init(1);
             
            var va_green2 = new LookupAtTime('green');
            va_green2.addValueKey(0,-50);
            va_green2.addValueKey(40,100, Easings.easeOut, 0.5);
            va_green2.addValueKey(52,0, Easings.easeOut, 0.5);
            va_green2.addValueKey(65,100, Easings.easeOut, 0.5);
            va_green2.addValueKey(75,60, Easings.easeInOut);
            va_green2.addValueKey(100,0,Easings.easeIn);
            va_green2.init(1);

            var va_blue2 = new LookupAtTime('blue');
            va_blue2.addValueKey(0,-50);
            va_blue2.addValueKey(50,100, Easings.easeinBounce, 0.5);
            va_blue2.addValueKey(95,60, Easings.easeInOutQuad);
            va_blue2.addValueKey(100,0,Easings.easeOutBounce, 3.1);
            va_blue2.init(1);            

            var va_pos_x2 = new LookupAtTime('xpos');
            va_pos_x2.addValueKey(0,-50);
            va_pos_x2.addValueKey(30,100, Easings.easeOutCirc, 0.5);
            va_pos_x2.addValueKey(70,100);
            va_pos_x2.addValueKey(90,0,Easings.easeInCirc);
            va_pos_x2.init(1);

            var va_pos_y2 = new LookupAtTime('ypos');
            //  Random generated value keys. They are automatically sorted by time on init.
            for (let i=0; i< 17; i++){
                va_pos_y2.addValueKey(Math.random()*100, Math.random()*100);
            }
            va_pos_y2.init(1);     

            var va_scale_x2 = new LookupAtTime('xscale');
            va_scale_x2.addValueKey(8,500);
            va_scale_x2.addValueKey(23,1000, Easings.easeInOutElastic, 0.9);
            va_scale_x2.addValueKey(44, 0, Easings.easeInOutElastic, 0.9);
            va_scale_x2.addValueKey(70, 0, Easings.easeInOut);
            va_scale_x2.init(0.01);
            
            var va_scale_y2 = new LookupAtTime('yscale');
            va_scale_y2.addValueKey(8,500);
            va_scale_y2.addValueKey(37,0, Easings.easeInOutElastic, 0.9);
            va_scale_y2.addValueKey(84, 1000, Easings.easeOutElastic, 0.9);
            va_scale_y2.addValueKey(90, 0, Easings.easeInCirc);
            va_scale_y2.init(0.01); 

            var va_rotate_x2 = new LookupAtTime('xrot');
            va_rotate_x2.addValueKey(10,-50);
            va_rotate_x2.addValueKey(30,100, Easings.easeOut, 0.5);
            va_rotate_x2.addValueKey(75,60, Easings.easeInOut);
            va_rotate_x2.addValueKey(100,0,Easings.easeIn);
            va_rotate_x2.init(1);

            var va_rotate_y2 = new LookupAtTime('yrot');
            va_rotate_y2.addValueKey(8,500);
            va_rotate_y2.addValueKey(63,1000, Easings.easeInOutElastic, 0.9);
            va_rotate_y2.addValueKey(70, 0, Easings.easeOutElastic, 0.9);
            va_rotate_y2.addValueKey(75, 600, Easings.easeInOut);
            va_rotate_y2.init(0.01);

            var va_rotate_z2 = new LookupAtTime('zrot');
            va_rotate_z2.addValueKey(0,0);
            va_rotate_z2.addValueKey(30,0);
            va_rotate_z2.addValueKey(100,360, Easings.linear);
            va_rotate_z2.init(0.1);


            var timeLine = new ValueAtTimeLine(document.querySelector('#timeline'), 0, 100)
            let circle1 = timeLine.addNewValueAtGroup('Circle 1', true);
            let colorGroup1 = circle1.addNewValueAtGroup('Color', true);
            colorGroup1.addValueAt(va_red1, 'Red',1, '#f00');
            colorGroup1.addValueAt(va_green1, 'Green', 1, '#0f0');
            colorGroup1.addValueAt(va_blue1, 'Blue', 1, '#00f');

            let transformGroup1 = circle1.addNewValueAtGroup('Tranform', true);

            let positionGroup1 = transformGroup1.addNewValueAtGroup('Position', true);
            positionGroup1.addValueAt(va_pos_x1, 'Pos X', 1);
            positionGroup1.addValueAt(va_pos_y1, 'Pos y', 1);

            let scaleGroup1 = transformGroup1.addNewValueAtGroup('Scale', true);
            scaleGroup1.addValueAt(va_scale_x1, 'Scale X', 1, '#5197ff'); 
            scaleGroup1.addValueAt(va_scale_y1, 'Scale Y', 1, '#5197ff');            

            let rotateGroup1 = transformGroup1.addNewValueAtGroup('Rotate', true);
            rotateGroup1.addValueAt(va_rotate_x1, 'Rotate X', 1, '#D0FF72');
            rotateGroup1.addValueAt(va_rotate_y1, 'Rotate Y', 1, '#D0FF72');
            rotateGroup1.addValueAt(va_rotate_z1, 'Rotate Z', 1, '#D0FF72');

            let circle2 = timeLine.addNewValueAtGroup('Circle 2', true);

            let colorGroup2 = circle2.addNewValueAtGroup('Color', true);
            colorGroup2.addValueAt(va_red2, 'Red', 1, '#f00');
            colorGroup2.addValueAt(va_green2, 'Green', 1, '#0f0');
            colorGroup2.addValueAt(va_blue2, 'Blue', 1, '#00f');

            let transformGroup2 = circle2.addNewValueAtGroup('Tranform', true);

            let positionGroup2 = transformGroup2.addNewValueAtGroup('Position', true);
            positionGroup2.addValueAt(va_pos_x2, 'Pos X', 1);
            positionGroup2.addValueAt(va_pos_y2, 'Pos y', 1);

            let scaleGroup2 = transformGroup2.addNewValueAtGroup('Scale', true);
            scaleGroup2.addValueAt(va_scale_x2, 'Scale X', 1, '#5197ff'); 
            scaleGroup2.addValueAt(va_scale_y2, 'Scale Y', 1, '#5197ff');            

            let rotateGroup2 = transformGroup2.addNewValueAtGroup('Rotate', true);
            rotateGroup2.addValueAt(va_rotate_x2, 'Rotate X', 1, '#D0FF72');
            rotateGroup2.addValueAt(va_rotate_y2, 'Rotate Y', 1, '#D0FF72');
            rotateGroup2.addValueAt(va_rotate_z2, 'Rotate Z', 1, '#D0FF72');
  
            for (let i=3; i< 16; i++){
                let circle2 = timeLine.addNewValueAtGroup('Circle ' + i, false);

                let colorGroup2 = circle2.addNewValueAtGroup('Color', false);
                colorGroup2.addValueAt(va_red2, 'Red', 1, '#f00');
                colorGroup2.addValueAt(va_green2, 'Green', 1, '#0f0');
                colorGroup2.addValueAt(va_blue2, 'Blue', 1, '#00f');

                let transformGroup2 = circle2.addNewValueAtGroup('Tranform', false);

                let positionGroup2 = transformGroup2.addNewValueAtGroup('Position', false);
                positionGroup2.addValueAt(va_pos_x2, 'Pos X', 1);
                positionGroup2.addValueAt(va_pos_y2, 'Pos y', 1);

                let scaleGroup2 = transformGroup2.addNewValueAtGroup('Scale', false);
                scaleGroup2.addValueAt(va_scale_x2, 'Scale X', 1, '#5197ff'); 
                scaleGroup2.addValueAt(va_scale_y2, 'Scale Y', 1, '#5197ff');            

                let rotateGroup2 = transformGroup2.addNewValueAtGroup('Rotate', false);
                rotateGroup2.addValueAt(va_rotate_x2, 'Rotate X', 1, '#D0FF72');
                rotateGroup2.addValueAt(va_rotate_y2, 'Rotate Y', 1, '#D0FF72');
                rotateGroup2.addValueAt(va_rotate_z2, 'Rotate Z', 1, '#D0FF72');
            }




/*
            timeLine.lineWrapDiv.innerHTML +=
            '<ul id="myUL">'+
                '<li><span class="caret">Circle</span>'+
                    '<ul class="nested">'+
                        '<div>Radius</div>'+
                        '<div>Segments</div>'+
                        '<li><span class="caret">Color</span>'+
                            '<ul class="nested">'+
                                '<div>Red</div>'+
                                '<div>Green</div>'+
                                '<div>Blue</div>'+
                            '</ul>'+
                        '</li>'+
                        '<li><span class="caret">Position</span>'+
                            '<ul class="nested">'+
                                '<div>X</div>'+
                                '<div>Y</div>'+
                            '</ul>'+
                        '</li>'
                    '</ul>'+
                '</li>'+
            '</ul>';
            
            var toggler = document.getElementsByClassName("caret");
            var i;

            for (i = 0; i < toggler.length; i++) {
            toggler[i].addEventListener("click", function() {
                this.parentElement.querySelector(".nested").classList.toggle("active");
                this.classList.toggle("caret-down");
            });
            }

*/
            /*
            let button = document.createElement('div');
            button.id = 'exportStepListBtn';
            button.innerText = 'Save stepper curve to steplist.bin file.';
            button.addEventListener('click', (e)=>{
                console.log(lookupAtExport.computeStepList(stepper, 20000, 'steplist.bin').toString());
            });
            timeline.headerDiv.appendChild(button);
            */

            window.computeStepList = lookupAtExport.computeStepList;
            window.typedArrayToFile = lookupAtExport.typedArrayToFile;
            window.Easings = Easings;
            window.valueAtTimeline = timeLine;
            
        </script>
    </body>
</html>

